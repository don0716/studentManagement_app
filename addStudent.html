<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>studentManagementApp</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" rel="stylesheet"
    type="text/css" />
</head>

<body>
  <header class=" py-2">
    <nav class="navbar navbar-expand-lg bg-light">
      <div class="container">
        <p class="navbar-brand">Student Management</p>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <div class="ms-auto d-flex">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a href="index.html" class="nav-link ">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link " href="/studentList.html">Student List</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="/addStudent.html">Add Student</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <main class="container mt-2">

    <div>
      <h1>Add Student</h1>
    </div>

    <form id="postForm" class="mt-4">
      <label class="form-label mt-2" for="name">Name:</label>
      <input class="form-control" type="text" id="name">
        

      <label class="form-label mt-2" for="age">Age:</label>
      <input class="form-control" type="number" id="age">

      <label class="form-label mt-2" for="gender">Gender:</label>
      <select class="form-select" type="number" id="gender">
        <option value="Male" selected>Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select>

      <label class="form-label mt-2" for="grade">Grade:</label>
      <input class="form-control" type="text" id="grade">

      <label class="form-label mt-2" for="marks">Marks:</label>
      <input class="form-control" type="number" id="marks">

      <label class="form-label mt-2" for="attendance">Attendance:</label>
      <input class="form-control" type="number" id="attendance">

      <div id="message"></div>

      <button type="submit" class="btn btn-primary btn-sm mt-3 mb-5">Add Student</button>
       
    </form>
    
  </main>

  <script>
    const postForm = document.querySelector("#postForm")
    const name = document.querySelector("#name")
    const age = document.querySelector("#age")
    const gender = document.querySelector("#gender")
    const grade = document.querySelector("#grade")
    const marks = document.querySelector("#marks")
    const attendance = document.querySelector("#attendance")
    const apiUrl = 'https://student-management-Student-neog.replit.app/students'
    const message = document.querySelector("#message")

    postForm.addEventListener('submit', postApiData => {
      event.preventDefault()

      message.innerHTML = `<div class="spinner-border m-2" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>`
      
      const appData = {
        name: name.value,
        age: age.value,
        gender: gender.value,
        grade: grade.value,
        marks: marks.value,
        attendance: attendance.value
      }

      if(appData.name !== "" && appData.age !== "" && appData.gender !== "" | appData.grade !== "" && appData.marks !== "" && appData.attendance !== ""){

        fetch(apiUrl, {
          method: 'POST',
          body: JSON.stringify(appData),
          headers: {
          'Content-Type': 'application/json'
          }
        }).then(res => res.json())
          .then(data => {
            console.log(data)
            if(data){
              message.innerHTML = `<div class="text-success fw-bold">Student Data Added Successfully to the Bankend!</div>`

              clearMessage(2000)
              clearInputs() //clears all input fields.
              console.log(data)

            }else {
              message.innerHTML = `<div class="text-danger fw-bold">There is an issue with the data from the backend side!</div>`
              clearInputs() //clears all input fields.
              
            }
            
          }).catch(e => {
            message.innerHTML = `<div class="text-danger fw-bold">There seems to be an ERROR. Error Message: ${e.message}!</div>`
            clearMessage(2000)
            clearInputs() //clears all input fields.
          })
        
      } else {
         message.innerHTML = `<div class="text-danger fw-bold">Please Fill in All Fields!</div>`
        clearMessage(1800)
      }

      
    })

    const clearInputs = () => {
      name.value = ""
      age.value = ""
      gender.value = ""
      grade.value = ""
      marks.value = ""
      attendance.value = ""
    }

    const clearMessage = (t) => {
      setTimeout(()=> {
        message.innerHTML = ""
      }, t)
    }
    
    
  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js
"></script>
</body>

</html>